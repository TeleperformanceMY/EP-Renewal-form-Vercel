const fs = require("fs");

function readPkg() {
  const raw = fs.readFileSync("./package.json", "utf8");
  return JSON.parse(raw);
}

function isVulnerable(version, fixed) {
  const v = version.replace("^", "").replace("~", "");
  const fv = fixed.split(".");
  const cv = v.split(".");

  for (let i = 0; i < fv.length; i++) {
    if (parseInt(cv[i]) < parseInt(fv[i])) return true;
    if (parseInt(cv[i]) > parseInt(fv[i])) return false;
  }
  return false;
}

function main() {
  const pkg = readPkg();
  const deps = { ...pkg.dependencies, ...pkg.devDependencies };

  const react = deps["react"];
  const next = deps["next"];
  const rsc = deps["react-server-dom-webpack"];

  console.log("\n=== React2Shell Vulnerability Check ===\n");

  if (!react || !next) {
    console.log("Missing react or next in dependencies.");
    return;
  }

  if (isVulnerable(react, "19.0.1"))
    console.log(`❌ React version ${react} is vulnerable.`);
  else
    console.log(`✅ React version ${react} is safe.`);

  if (isVulnerable(next, "15.0.0"))
    console.log(`❌ Next.js version ${next} may be vulnerable.`);
  else
    console.log(`✅ Next.js version ${next} is safe.`);

  if (rsc && isVulnerable(rsc, "19.0.1"))
    console.log(`❌ RSC runtime ${rsc} is vulnerable.`);

  console.log("\nDone.\n");
}

main();

